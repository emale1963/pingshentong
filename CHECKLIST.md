# 部署前检查清单

在部署到云服务器之前，请逐项确认以下内容。

## 🔧 环境准备

- [ ] 服务器操作系统为 Ubuntu 20.04+ 或 CentOS 7+
- [ ] 服务器配置满足最低要求（2核CPU，4GB内存，20GB磁盘）
- [ ] 服务器可访问外网（用于下载依赖和调用AI服务）
- [ ] 已配置防火墙规则（开放22、80、443端口）
- [ ] 已配置 SSH 密钥登录，禁用密码登录（推荐）

## 📦 依赖安装

### Docker 部署

- [ ] 已安装 Docker 20.10+
- [ ] 已安装 Docker Compose 2.0+
- [ ] Docker 服务正常运行

### 直接部署

- [ ] 已安装 Node.js 18+ 或 20+
- [ ] 已安装 pnpm 8+
- [ ] 已安装 PostgreSQL 14+
- [ ] 已安装 Nginx 1.18+
- [ ] 已安装 PM2（用于进程管理）

## 🗄️ 数据库配置

- [ ] PostgreSQL 服务正常运行
- [ ] 已创建数据库 `report_review`
- [ ] 已创建数据库用户 `review_user`
- [ ] 数据库用户已获得适当权限
- [ ] 数据库配置参数已优化（连接池、超时等）

## 🔐 安全配置

- [ ] 修改了所有默认密码
- [ ] 配置了强密码策略
- [ ] 设置了 JWT 密钥（使用强随机字符串）
- [ ] 设置了 Session 密钥
- [ ] 设置了 Cookie 密钥
- [ ] 数据库仅允许本地连接（5432端口未对外开放）
- [ ] 已配置 HTTPS（生产环境必须）

## 🔑 环境变量配置

### 必须配置

- [ ] `DB_PASSWORD` - 数据库密码（强密码）
- [ ] `AI_API_KEY` - AI服务API密钥
- [ ] `AI_API_URL` - AI服务API地址
- [ ] `JWT_SECRET` - JWT密钥（32+字符随机字符串）
- [ ] `SESSION_SECRET` - Session密钥
- [ ] `COOKIE_SECRET` - Cookie加密密钥

### 可选配置

- [ ] `AWS_ACCESS_KEY_ID` - 对象存储访问密钥ID
- [ ] `AWS_SECRET_ACCESS_KEY` - 对象存储访问密钥
- [ ] `S3_BUCKET_NAME` - 对象存储桶名称
- [ ] `APP_URL` - 应用完整URL
- [ ] `SMTP_*` - 邮件服务配置（如需邮件通知）

## 🌐 网络配置

- [ ] 域名已解析到服务器IP
- [ ] Nginx 已正确配置反向代理
- [ ] Nginx 配置已测试（`nginx -t`）
- [ ] SSL 证书已配置（生产环境）
- [ ] SSL 证书自动续期已配置

## 🚀 应用部署

- [ ] 代码已上传到服务器
- [ ] 依赖已安装（`pnpm install`）
- [ ] 应用已构建（`pnpm run build`）
- [ ] 数据库表已初始化（`schema.sql`）
- [ ] 示例数据已导入（如需要）
- [ ] 应用已启动（PM2 或 Docker）
- [ ] PM2 已配置开机自启

## ✅ 功能验证

### 基础功能

- [ ] 首页可正常访问
- [ ] 静态资源加载正常
- [ ] 文件上传功能正常
- [ ] 数据库连接正常

### 核心功能

- [ ] 报告提交功能正常
- [ ] AI 评审功能正常
- [ ] 评审结果展示正常
- [ ] 报告导出功能正常
- [ ] 管理后台可正常访问

### API 接口

- [ ] `GET /api/reports` - 获取报告列表
- [ ] `POST /api/reports` - 提交报告
- [ ] `GET /api/reports/{id}` - 获取报告详情
- [ ] `POST /api/reports/{id}/review` - 触发评审
- [ ] `POST /api/reports/{id}/exports` - 创建导出

## 📊 性能优化

- [ ] Nginx 已启用 Gzip 压缩
- [ ] 已配置静态资源缓存
- [ ] 数据库连接池已优化
- [ ] Nginx 缓存已配置（可选）
- [ ] 应用日志已配置

## 🛡️ 安全加固

- [ ] 防火墙规则已配置
- [ ] 不必要的端口已关闭
- [ ] SSH 仅允许密钥登录
- [ ] Root 登录已禁用
- [ ] 失败登录锁定已启用
- [ ] 定期安全更新计划已制定

## 💾 备份策略

- [ ] 数据库自动备份脚本已配置
- [ ] 备份存储位置已确定
- [ ] 备份保留策略已设置
- [ ] 备份恢复流程已测试
- [ ] 文件备份已配置（如有）

## 📝 监控和日志

- [ ] 应用日志已配置
- [ ] Nginx 日志已配置
- [ ] 日志轮转已配置
- [ ] 监控工具已安装（可选）
- [ ] 告警机制已设置（可选）

## 🔄 运维准备

- [ ] 运维文档已阅读
- [ ] 常用命令已掌握
- [ ] 故障排查流程已熟悉
- [ ] 紧急联系人已确定
- [ ] 回滚方案已准备

---

## 🎯 部署后首次操作

部署完成后，请执行以下首次操作：

1. [ ] 初始化管理员账户
2. [ ] 登录管理后台
3. [ ] 配置 AI 服务（如果未配置）
4. [ ] 配置对象存储（如果未配置）
5. [ ] 创建评审标准
6. [ ] 创建评审模型
7. [ ] 测试完整流程
8. [ ] 创建第一个测试评审报告

---

## 📞 技术支持

如遇到部署问题，请准备以下信息寻求帮助：

- 服务器操作系统和版本
- Node.js 和 pnpm 版本
- PostgreSQL 版本
- Docker 版本（如使用 Docker）
- 错误日志（PM2 日志、Nginx 日志、应用日志）
- 环境变量配置（脱敏后）

---

## ✨ 部署成功标志

部署成功的标志：

- ✅ 访问应用首页正常显示
- ✅ 能够成功登录管理后台
- ✅ 能够上传文件并触发评审
- ✅ AI 评审功能正常工作
- ✅ 能够导出评审报告
- ✅ HTTPS 访问正常（生产环境）
- ✅ 日志无严重错误
- ✅ 服务自动重启正常

祝部署顺利！
